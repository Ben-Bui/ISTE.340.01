<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Project 1</title>
    <link rel="stylesheet" href="styles.css">
<script>
    // Browser detection: if not modern, redirect to Firefox download page
    if( !document.getElementById){
        // Send them to Firefox download page
        window.location="https://www.mozilla.org/en-US/firefox/new/";
    }

    var ie7 = false;

    function $(id){
        return document.getElementById(id);
    }
</script>

<!--[if lt IE 8]>
<script>
    var ie7 = true;
</script>
<![endif]-->

<script src="data.js"></script>
<script src="cookies.js"></script>

<script>
var selectedTeam;
var opacity = 0;

function animation(dom){
    // If result image is passed in
    if (dom.nodeName == "IMG"){
        if (isNaN((dom.style.opacity))){
            dom.style.opacity = 0;
        }
        if(dom.style.opacity < 1.0){
            dom.style.opacity = opacity;
            opacity += 0.02;
            setTimeout(function(){ animation(dom); }, 30); 
        }
    }
    else {
        var hold = dom.parentNode.nextSibling;
        if (isNaN(parseInt(hold.style.marginLeft))){
            hold.style.marginLeft = "5px";
        }
        
        if (hold == document.getElementById("container").childNodes[2]){
            if(parseInt(hold.style.marginLeft) < 100){
                hold.style.marginLeft = parseInt(hold.style.marginLeft) + 3 + 'px';    
                setTimeout(function(){ animation(dom); }, 30); 
            }
        }
        if (hold == document.getElementById("container").childNodes[3]){
            if(parseInt(hold.style.marginLeft) < 200){
                hold.style.marginLeft = parseInt(hold.style.marginLeft) + 3 + 'px';    
                setTimeout(function(){ animation(dom); }, 30); 
            }
        }
        if (hold == document.getElementById("container").childNodes[4]){
            if(parseInt(hold.style.marginLeft) < 300){
                hold.style.marginLeft = parseInt(hold.style.marginLeft) + 5 + 'px';    
                setTimeout(function(){ animation(dom); }, 30); 
            }
        }
    }
}

function validate(){
    var errMsg= "";
    var start="Please complete the following fields: ";

    // Check if the first name is empty
    if (!$("first-name").value){
        errMsg += "First Name, ";
        $("first-name").style.border = "solid red";
    }
    else{
        $("first-name").style.border = "2px inset #EBE9ED";
        if(localStorage){
            if(!localStorage.getItem('firstname')){
                localStorage.setItem('firstname', $('first-name').value);
            }
        }
        else{
            if(GetCookie('firstname') == null){
                SetCookie('firstname', $('first-name').value);
            }
        }
    }

    // Check if the last name is empty
    if (!$("last-name").value){
        errMsg += "Last Name, ";
        $("last-name").style.border = "solid red";
    }
    else{
        $("last-name").style.border = "2px inset #EBE9ED";
        if(localStorage){
            if(!localStorage.getItem('lastname')){
                localStorage.setItem('lastname', $('last-name').value);
            }
        }
        else{
            if(GetCookie('lastname') == null){
                SetCookie('lastname', $('last-name').value);
            }
        }
    }

    // Check if the age is empty or invalid
    if (!$("age").value){
        errMsg += "Age, ";
        $("age").style.border = "solid red";
    }
    else{
        $("age").style.border = "2px inset #EBE9ED";
        if(localStorage){
            if(!localStorage.getItem('age')){
                localStorage.setItem('age', $('age').value);
            }
        }
        else{
            if(GetCookie('age') == null){
                SetCookie('age', $('age').value);
            }
        }
    }

    // Check if the state is empty
    if (!$("state").value){
        errMsg += "State ";
        $("state").style.border = "solid red";
    }
    else{
        $("state").style.border = "2px inset #EBE9ED";
        if(localStorage){
            if(!localStorage.getItem('state')){
                localStorage.setItem('state', $('state').value);
            }
        }
        else{
            if(GetCookie('state') == null){
                SetCookie('state', $('state').value);
            }
        }
    }

    if(errMsg != ""){
        var feedbackDiv = $("feedback-div");

        var p = document.createElement('p');
        p.setAttribute('class','feedback');
        var text = document.createTextNode(start + errMsg);
        p.appendChild(text);
        feedbackDiv.appendChild(p);

        if(document.getElementById("feedback-div").childNodes.length > 1){
            feedbackDiv.removeChild(document.getElementById("feedback-div").childNodes[0]);
        }

        feedbackDiv.style.display = "block";
        return false; 
    }
}

function construct(dom){
    var hold = data[dom.value];
    if (hold !== undefined){
        var length = hold.length;
        var div = document.createElement('div');
        div.setAttribute('class', 'divContainer');
        $('container').appendChild(div);

        var divImg = document.createElement('div');
        div.appendChild(divImg);

        var img = document.createElement('img');
        img.setAttribute('class','img');
        img.src = hold[0];
        divImg.appendChild(img);

        var sel = document.createElement('select');
        sel.setAttribute('name', 'selectmenu');
        sel.setAttribute('onchange', 'construct(this); animation(this)');
        for (var i = 1; i < length; i++){
            var opt = document.createElement('option');
            if(i == 1){
                opt.setAttribute('disabled','disabled');
                opt.setAttribute('selected','selected');
            }
            opt.setAttribute('value', hold[i]);
            opt.appendChild(document.createTextNode(hold[i]));
            sel.appendChild(opt);
        }
        div.appendChild(sel);
    }
    else {
        selectedTeam = dom.value;
        var resImg = document.createElement('img');
        resImg.setAttribute('id','resultImg');          
        resImg.src = res[selectedTeam];
        opacity = 0;
        animation(resImg);

        var divForm = document.createElement('div');
        divForm.setAttribute('class', 'divContainer');
        var feedbackDiv = document.createElement('div');
        feedbackDiv.setAttribute('id','feedback-div');
        divForm.appendChild(feedbackDiv);
        $('container').appendChild(divForm);

        var form = document.createElement('form');
        form.setAttribute('method','post');
        form.setAttribute('id','contact-form');
        form.setAttribute('action','project1.html');
        form.setAttribute('onsubmit','return validate();');
        divForm.appendChild(form);

        var p = document.createElement('p');
        var label = document.createElement('label');
        var text = document.createTextNode("First Name");
        label.appendChild(text);
        label.setAttribute('for','first-name');
        var firstName = document.createElement('input');
        firstName.setAttribute('name','first-name');
        firstName.setAttribute('id','first-name');
        firstName.setAttribute('size','16');
        firstName.setAttribute('maxlength','16');
        label.appendChild(firstName);
        p.appendChild(label);

        // Load stored values
        if(localStorage){
            if(localStorage.getItem('firstname')){
                firstName.value = localStorage.getItem('firstname');
            }
        }
        else{
            if(GetCookie('firstname') != null){
                firstName.value = GetCookie('firstname');
            }
        }

        form.appendChild(p);
        // Repeat similar process for last name, age, and state

        var submit = document.createElement('input');
        submit.setAttribute('type','submit');
        submit.setAttribute('value','submit');
        submit.setAttribute('id','submit');
        p.appendChild(submit);

        form.appendChild(p);      
        document.getElementById("result").appendChild(resImg);
    }
}
</script>
</head>
<body onload="construct('init')">
    <div id="result"></div>
    <div id="container"></div>
</body>
</html>
